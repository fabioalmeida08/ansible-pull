- name: config_autostart_desktopfile
  tags: desktop file, config, script, autostart
  lineinfile:
    path: "{{ home }}/.config/autostart/modmap.desktop"
    regexp: "^Exec"
    line: "Exec={{ home }}/.scripts/modmap.sh"

- name: config_git_config
  tags: gitconfig, config,
  lineinfile:
    path: "{{ home }}/.gitconfig"
    regexp: "{{ item.regexp }}"
    line: "{{ item.line }}"
  with_items:
    - { regexp: "^name", line: "name = {{ git_username }}" }
    - { regexp: "^email", line: "email = {{ git_email }}" }

- name: ensure group docker exists
  tags: docker, group
  group:
    name: docker
    state: present

- name: add user to docker group
  tags: docker, group, add user
  user:
    name: "{{ user }}"
    groups: docker
    append: yes

- name: start prometheus service
  tags: prometheus, service
  service:
    name: prometheus
    state: started
    enabled: yes

- name: start prometheus-node-exporter service
  tags: prometheus-node-exporter, service
  service:
    name: prometheus-node-exporter
    state: started
    enabled: yes

- name: start grafana service
  tags: grafana, service
  service:
    name: grafana
    state: started
    enabled: yes

- name: install powerlevel10k theme
  tags: powerlevel10k, theme, zsh
  git:
    repo: https://github.com/romkatv/powerlevel10k.git
    dest: "{{ home }}/.oh-my-zsh/custom/themes/powerlevel10k"
  notify: set powerlevel10k for zsh theme

- name: set powerlevel10k for zsh theme
  tags: powerlevel10k, theme, zsh
  lineinfile:
    path: "{{ home }}/.zshrc"
    regexp: "^ZSH_THEME="
    line: ZSH_THEME="powerlevel10k/powerlevel10k"

- name: remove original prometheus file
  file:
    path: "/etc/prometheus"
    state: absent

- name: set new personal prometheus file
  copy:
    src: "{{ home }}/.dotfiles/prometheus.yml"
    dest: "/etc/prometheus/"
    owner: "{{ user }}"
    group: "{{ user }}"
    mode: "0755"
